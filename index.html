<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediBook - åŒ»ç™‚æ©Ÿé–¢å‘ã‘Webäºˆç´„ã‚·ã‚¹ãƒ†ãƒ </title>
    <meta name="description" content="ä¸­å°ã‚¯ãƒªãƒ‹ãƒƒã‚¯å‘ã‘ã®åŒ…æ‹¬çš„ãªWebäºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¾…ã¡æ™‚é–“è¡¨ç¤ºã€ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€PWAå¯¾å¿œã‚’å®Ÿç¾ã€‚">
    
    <!-- OGP Tags -->
    <meta property="og:title" content="MediBook - åŒ»ç™‚æ©Ÿé–¢å‘ã‘Webäºˆç´„ã‚·ã‚¹ãƒ†ãƒ ">
    <meta property="og:description" content="ä¸­å°ã‚¯ãƒªãƒ‹ãƒƒã‚¯å‘ã‘ã®åŒ…æ‹¬çš„ãªWebäºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¾…ã¡æ™‚é–“è¡¨ç¤ºã€ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚’å®Ÿç¾ã€‚">
    <meta property="og:image" content="https://cdn1.genspark.ai/user-upload-image/22_generated/1f2de782-151e-4db9-abe0-42b8381daca9">
    <meta property="og:url" content="https://appadaycreator.github.io/medibook-reservation-system">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MediBook - åŒ»ç™‚æ©Ÿé–¢å‘ã‘Webäºˆç´„ã‚·ã‚¹ãƒ†ãƒ ">
    <meta name="twitter:description" content="ä¸­å°ã‚¯ãƒªãƒ‹ãƒƒã‚¯å‘ã‘ã®åŒ…æ‹¬çš„ãªWebäºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¾…ã¡æ™‚é–“è¡¨ç¤ºã€ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚’å®Ÿç¾ã€‚">
    <meta name="twitter:image" content="https://cdn1.genspark.ai/user-upload-image/22_generated/1f2de782-151e-4db9-abe0-42b8381daca9">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiMzMzczZGMiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNOSAxMWgtM2EyIDIgMCAwIDAtMiAydjNhMiAyIDAgMCAwIDIgMmgzdjNhMiAyIDAgMCAwIDIgMmgzYTIgMiAwIDAgMCAyLTJ2LTNhMiAyIDAgMCAwLTItMmgtM3YtM2EyIDIgMCAwIDAtMi0ySDlhMiAyIDAgMCAwLTIgMnYzeiIvPjwvc3ZnPg==">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->
    
    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <style>
        :root {
            --medical-blue: #3373dc;
            --medical-light-blue: #dbf4ff;
            --medical-green: #10b981;
            --medical-red: #ef4444;
            --medical-gray: #6b7280;
            --base-font-size: 16px;
        }

        html {
            font-size: var(--base-font-size);
        }
        
        .medical-gradient {
            background: linear-gradient(135deg, var(--medical-blue) 0%, #60a5fa 100%);
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .medical-input {
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .medical-input:focus {
            border-color: var(--medical-blue);
            box-shadow: 0 0 0 3px rgba(51, 115, 220, 0.1);
        }
        
        .appointment-card {
            transition: all 0.3s ease;
        }
        
        .appointment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
</style>
    <!-- Supabase Edge Functions ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä¸è¦ -->
</head>
<body class="bg-gray-50 font-sans">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Navigation -->
    <nav class="medical-gradient text-white sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-heartbeat text-2xl"></i>
                    <span class="text-xl font-bold">MediBook</span>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="#home" class="hover:text-blue-200 transition-colors">ãƒ›ãƒ¼ãƒ </a>
                    <a href="#booking" class="hover:text-blue-200 transition-colors">äºˆç´„</a>
                    <a href="#status" class="hover:text-blue-200 transition-colors">çŠ¶æ³ç¢ºèª</a>
                    <a href="admin/" class="hover:text-blue-200 transition-colors">ç®¡ç†è€…</a>
                </div>
                <div class="hidden md:flex space-x-2 items-center">
                    <button onclick="decreaseFontSize()" class="px-2 py-1 bg-blue-500 rounded">A-</button>
                    <button onclick="increaseFontSize()" class="px-2 py-1 bg-blue-500 rounded">A+</button>
                </div>
                <button id="mobileMenuBtn" class="md:hidden">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="hideMobileMenu(event)">
        <div class="bg-white w-64 h-full p-6">
            <button id="closeMobileMenu" class="float-right text-gray-600" onclick="hideMobileMenu(event)">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="mt-8 space-y-4">
                <a href="#home" class="block text-gray-800 hover:text-blue-600">ãƒ›ãƒ¼ãƒ </a>
                <a href="#booking" class="block text-gray-800 hover:text-blue-600">äºˆç´„</a>
                <a href="#status" class="block text-gray-800 hover:text-blue-600">çŠ¶æ³ç¢ºèª</a>
                <a href="admin/" class="block text-gray-800 hover:text-blue-600">ç®¡ç†è€…</a>
                <div class="flex space-x-2 mt-4">
                    <button onclick="decreaseFontSize()" class="px-2 py-1 bg-blue-500 text-white rounded">A-</button>
                    <button onclick="increaseFontSize()" class="px-2 py-1 bg-blue-500 text-white rounded">A+</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- Home Section -->
        <section id="home" class="mb-12">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                    MediBook
                    <span class="text-blue-600">äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </span>
                </h1>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    ä¸­å°ã‚¯ãƒªãƒ‹ãƒƒã‚¯å‘ã‘ã®åŒ…æ‹¬çš„ãªWebäºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚<br>
                    ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¾…ã¡æ™‚é–“è¡¨ç¤ºã¨ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚’å®Ÿç¾ã€‚
                </p>
            </div>

            <!-- Status Cards -->
            <div class="grid md:grid-cols-3 gap-6 mb-12">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">ç¾åœ¨ã®å¾…ã¡æ™‚é–“</h3>
                        <div class="pulse-dot w-3 h-3 bg-green-500 rounded-full"></div>
                    </div>
                    <div class="text-3xl font-bold text-green-600 mb-2" id="currentWaitTime">ç´„15åˆ†</div>
                    <p class="text-sm text-gray-600">æœ€æ–°æ›´æ–°: <span id="lastUpdate">10:30</span></p>
                </div>
                
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">ä»Šæ—¥ã®äºˆç´„æ•°</h3>
                        <i class="fas fa-calendar-check text-blue-500 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-blue-600 mb-2" id="todayBookings">23</div>
                    <p class="text-sm text-gray-600">ç©ºãæ : <span id="availableSlots">7</span>æ </p>
                </div>
                
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">è¨ºç™‚çŠ¶æ³</h3>
                        <i class="fas fa-user-md text-purple-500 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-purple-600 mb-2">è¨ºç™‚ä¸­</div>
                    <p class="text-sm text-gray-600">å—ä»˜æ™‚é–“: 9:00-17:00</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="text-center space-x-4">
                <button onclick="showSection('booking')" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-calendar-plus mr-2"></i>æ–°è¦äºˆç´„
                </button>
                <button onclick="showSection('status')" class="bg-gray-600 hover:bg-gray-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-search mr-2"></i>äºˆç´„ç¢ºèª
                </button>
            </div>
        </section>

        <!-- Booking Section -->
        <section id="booking" class="mb-12 hidden">
            <div class="max-w-2xl mx-auto">
                <div class="bg-white rounded-lg p-8 card-shadow">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">
                        <i class="fas fa-calendar-plus text-blue-600 mr-3"></i>æ–°è¦äºˆç´„
                    </h2>
                    
                    <form id="bookingForm" class="space-y-6">
                        <!-- Patient Information -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">æ‚£è€…æƒ…å ±</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ãŠåå‰ *</label>
                                    <input type="text" id="patientName" required 
                                           class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none"
                                           placeholder="å±±ç”° å¤ªéƒ">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ•ãƒªã‚¬ãƒŠ *</label>
                                    <input type="text" id="patientKana" required 
                                           class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none"
                                           placeholder="ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">é›»è©±ç•ªå· *</label>
                                    <input type="tel" id="patientPhone" required 
                                           class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none"
                                           placeholder="090-1234-5678">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">å¹´é½¢</label>
                                    <input type="number" id="patientAge" min="0" max="120"
                                           class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none"
                                           placeholder="30">
                                </div>
                            </div>
                        </div>

                        <!-- Appointment Details -->
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">äºˆç´„è©³ç´°</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">å¸Œæœ›æ—¥ *</label>
                                    <input type="date" id="appointmentDate" required 
                                           class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">å¸Œæœ›æ™‚é–“ *</label>
                                    <select id="appointmentTime" required 
                                            class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none">
                                        <option value="">æ™‚é–“ã‚’é¸æŠ</option>
                                        <option value="09:00">09:00 - 09:15</option>
                                        <option value="09:15">09:15 - 09:30</option>
                                        <option value="09:30">09:30 - 09:45</option>
                                        <option value="09:45">09:45 - 10:00</option>
                                        <option value="10:00">10:00 - 10:15</option>
                                        <option value="10:15">10:15 - 10:30</option>
                                        <option value="10:30">10:30 - 10:45</option>
                                        <option value="10:45">10:45 - 11:00</option>
                                        <option value="14:00">14:00 - 14:15</option>
                                        <option value="14:15">14:15 - 14:30</option>
                                        <option value="14:30">14:30 - 14:45</option>
                                        <option value="14:45">14:45 - 15:00</option>
                                        <option value="15:00">15:00 - 15:15</option>
                                        <option value="15:15">15:15 - 15:30</option>
                                        <option value="15:30">15:30 - 15:45</option>
                                        <option value="15:45">15:45 - 16:00</option>
                                        <option value="16:00">16:00 - 16:15</option>
                                        <option value="16:15">16:15 - 16:30</option>
                                        <option value="16:30">16:30 - 16:45</option>
                                        <option value="16:45">16:45 - 17:00</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">å—è¨ºåŒºåˆ† *</label>
                                    <select id="visitType" required
                                            class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none">
                                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                        <option value="initial">åˆè¨º</option>
                                        <option value="followup">å†è¨º</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ç—‡çŠ¶ãƒ»ç›¸è«‡å†…å®¹</label>
                                <textarea id="symptoms" rows="3"
                                          class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none"
                                          placeholder="ç—‡çŠ¶ã‚„ç›¸è«‡ã—ãŸã„å†…å®¹ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰"></textarea>
                            </div>
                        </div>

                        <!-- Consent -->
                        <div class="bg-yellow-50 p-6 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <input type="checkbox" id="consent" required class="mt-1">
                                <label for="consent" class="text-sm text-gray-700 leading-relaxed">
                                    <strong>å€‹äººæƒ…å ±ã®å–æ‰±ã„ã«ã¤ã„ã¦åŒæ„ã—ã¾ã™ã€‚</strong><br>
                                    å…¥åŠ›ã„ãŸã ã„ãŸå€‹äººæƒ…å ±ã¯ã€è¨ºç™‚äºˆç´„ç®¡ç†ã®ãŸã‚ã®ã¿ã«ä½¿ç”¨ã—ã€
                                    é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®ã‚‚ã¨ç®¡ç†ã„ãŸã—ã¾ã™ã€‚
                                    è©³ç´°ã¯<a href="privacy.html" class="text-blue-600 underline">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
                                </label>
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-check mr-2"></i>äºˆç´„ã‚’ç¢ºå®šã™ã‚‹
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Status Check Section -->
        <section id="status" class="mb-12 hidden">
            <div class="max-w-2xl mx-auto">
                <div class="bg-white rounded-lg p-8 card-shadow">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">
                        <i class="fas fa-search text-green-600 mr-3"></i>äºˆç´„çŠ¶æ³ç¢ºèª
                    </h2>
                    
                    <form id="statusForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">äºˆç´„ID ã¾ãŸã¯ é›»è©±ç•ªå·</label>
                            <input type="text" id="searchQuery" required 
                                   class="w-full px-4 py-3 medical-input rounded-lg focus:outline-none"
                                   placeholder="äºˆç´„ID (ä¾‹: MB202312010001) ã¾ãŸã¯ é›»è©±ç•ªå·ã‚’å…¥åŠ›">
                        </div>
                        <div class="text-center">
                            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-search mr-2"></i>æ¤œç´¢
                            </button>
                        </div>
                    </form>

                    <!-- Search Results -->
                    <div id="searchResults" class="mt-8 hidden">
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">äºˆç´„æƒ…å ±</h3>
                            <div id="appointmentDetails" class="space-y-3">
                                <!-- Results will be populated here -->
                            </div>
                            <div class="mt-6 flex space-x-4">
                                <button onclick="generateQRTicket()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                                    <i class="fas fa-qrcode mr-2"></i>QRå—ä»˜ç¥¨
                                </button>
                                <button onclick="shareAppointment()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                                    <i class="fas fa-share mr-2"></i>ã‚·ã‚§ã‚¢
                                </button>
                                <button onclick="modifyAppointment()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg">
                                    <i class="fas fa-edit mr-2"></i>å¤‰æ›´
                                </button>
                                <button onclick="cancelAppointment()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg">
                                    <i class="fas fa-times mr-2"></i>ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <!-- Footer Sections -->
        <section id="footer-info" class="mt-16">
            <!-- SNS Share Modal -->
            <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">ã‚·ã‚§ã‚¢</h3>
                    <div class="space-y-3">
                        <button onclick="shareToX()" class="w-full bg-black text-white py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors">
                            <i class="fab fa-x-twitter mr-2"></i>X (Twitter) ã§ã‚·ã‚§ã‚¢
                        </button>
                        <button onclick="shareToLine()" class="w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fab fa-line mr-2"></i>LINE ã§ã‚·ã‚§ã‚¢
                        </button>
                        <button onclick="copyLink()" class="w-full bg-blue-500 text-white py-3 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-link mr-2"></i>ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                    <button onclick="closeShareModal()" class="mt-4 w-full bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                        é–‰ã˜ã‚‹
                    </button>
                </div>
            </div>

            <!-- QR Code Modal -->
            <div id="qrModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold text-gray-900 mb-4 text-center">å—ä»˜ç”¨QRã‚³ãƒ¼ãƒ‰</h3>
                    <div id="qrCode" class="text-center mb-4"></div>
                    <div class="text-center text-sm text-gray-600 mb-4">
                        å—ä»˜ã§ã“ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã”æç¤ºãã ã•ã„
                    </div>
                    <button onclick="closeQRModal()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                        é–‰ã˜ã‚‹
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="medical-gradient text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <i class="fas fa-heartbeat text-2xl"></i>
                        <span class="text-xl font-bold">MediBook</span>
                    </div>
                    <p class="text-blue-200">åŒ»ç™‚æ©Ÿé–¢ã¨æ‚£è€…æ§˜ã‚’ç¹‹ããƒ‡ã‚¸ã‚¿ãƒ«ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">ãƒªãƒ³ã‚¯</h4>
                    <div class="space-y-2 text-blue-200">
                        <div><a href="privacy.html" class="hover:text-white">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></div>
                        <div><a href="terms.html" class="hover:text-white">å…è²¬äº‹é …</a></div>
                        <div><a href="contact.html" class="hover:text-white">ãŠå•ã„åˆã‚ã›</a></div>
                        <div><a href="usage.html" class="hover:text-white">ä½¿ã„æ–¹</a></div>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">é–‹ç™ºè€…</h4>
                    <div class="text-blue-200">
                        <div>30æ—¥é€£ç¶šé–‹ç™ºãƒãƒ£ãƒ¬ãƒ³ã‚¸</div>
                        <div class="mt-2">
                            <a href="https://x.com/appadaycreator" target="_blank" class="hover:text-white">
                                <i class="fab fa-x-twitter mr-2"></i>@appadaycreator
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-8 pt-8 border-t border-blue-600">
                <p class="text-blue-200">Â© 2024 MediBook. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Supabase Edge Function ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURL
        const FUNCTION_URL = 'https://mdzpjdugshzyjmskjgkt.functions.supabase.co/appointments';

        // Data Storage
        let appointments = [];
        let currentAppointment = null;
        let baseFontSize = parseInt(getComputedStyle(document.documentElement).fontSize);

        function setBaseFontSize(size) {
            document.documentElement.style.setProperty('--base-font-size', size + 'px');
            baseFontSize = size;
            localStorage.setItem('medibook_fontsize', size);
        }

        function increaseFontSize() {
            setBaseFontSize(baseFontSize + 2);
        }

        function decreaseFontSize() {
            if (baseFontSize > 10) {
                setBaseFontSize(baseFontSize - 2);
            }
        }

        // Utility Functions
        function generateId() {
            const date = new Date();
            const dateStr = date.getFullYear().toString() +
                           (date.getMonth() + 1).toString().padStart(2, '0') +
                           date.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            return `MB${dateStr}${random}`;
        }

        async function fetchAppointments() {
            try {
                const res = await fetch(FUNCTION_URL);
                if (!res.ok) throw new Error(await res.text());
                appointments = await res.json() || [];
                saveData();
            } catch (error) {
                console.error(error);
                appointments = JSON.parse(localStorage.getItem('medibook_appointments') || '[]');
            }
        }

        function saveData() {
            localStorage.setItem('medibook_appointments', JSON.stringify(appointments));
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'});
        }

        function calculateWaitTime() {
            const waitingCount = appointments.filter(apt => apt.status === 'waiting').length;
            const avgTime = 15; // å¹³å‡è¨ºç™‚æ™‚é–“ï¼ˆåˆ†ï¼‰
            return Math.max(5, waitingCount * avgTime);
        }

        function updateStats() {
            const today = new Date().toDateString();
            const todayAppointments = appointments.filter(apt => new Date(apt.date).toDateString() === today);
            
            document.getElementById('todayBookings').textContent = todayAppointments.length;
            document.getElementById('currentWaitTime').textContent = `ç´„${calculateWaitTime()}åˆ†`;
            document.getElementById('availableSlots').textContent = Math.max(0, 30 - todayAppointments.length);
            
            /* ç®¡ç†è€…å‘ã‘æ©Ÿèƒ½ã¯åˆ¥ãƒšãƒ¼ã‚¸ã§æä¾› */
        }

        // Navigation
        function showSection(sectionId) {
            const sections = ['home', 'booking', 'status'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            if (sectionId === 'booking') {
                setMinDate();
            }
        }

        function setMinDate() {
            const today = new Date();
            // å½“æ—¥ã‹ã‚‰äºˆç´„å¯èƒ½
            const minDate = today.toISOString().split('T')[0];
            document.getElementById('appointmentDate').min = minDate;
        }

        // Mobile Menu
        function hideMobileMenu(e) {
            if (!e || e.target.id === 'mobileMenu' || e.target.id === 'closeMobileMenu') {
                document.getElementById('mobileMenu').classList.add('hidden');
            }
        }

        document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            document.getElementById('mobileMenu').classList.remove('hidden');
        });

        // Booking Form
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                id: generateId(),
                name: document.getElementById('patientName').value,
                kana: document.getElementById('patientKana').value,
                phone: document.getElementById('patientPhone').value,
                age: document.getElementById('patientAge').value || 'æœªè¨˜å…¥',
                date: document.getElementById('appointmentDate').value,
                time: document.getElementById('appointmentTime').value,
                visitType: document.getElementById('visitType').value,
                symptoms: document.getElementById('symptoms').value || 'ç‰¹ã«ãªã—',
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            // Validation
            if (!formData.name || !formData.phone || !formData.date || !formData.time || !formData.visitType) {
                alert('å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // Check for conflicts
            const conflictExists = appointments.some(apt => 
                apt.date === formData.date && 
                apt.time === formData.time && 
                apt.status !== 'cancelled'
            );

            if (conflictExists) {
                alert('é¸æŠã•ã‚ŒãŸæ—¥æ™‚ã¯æ—¢ã«äºˆç´„æ¸ˆã¿ã§ã™ã€‚åˆ¥ã®æ™‚é–“ã‚’ãŠé¸ã³ãã ã•ã„ã€‚');
                return;
            }

            appointments.push(formData);
            saveData();
            updateStats();
            fetch(FUNCTION_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            }).then(res => { if (!res.ok) return res.text().then(t => { throw new Error(t); }); })
              .catch(err => console.error(err));

            // Show confirmation
            alert(`äºˆç´„ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸã€‚ç®¡ç†è€…ã®æ‰¿èªã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚\n\näºˆç´„ID: ${formData.id}\næ—¥æ™‚: ${formData.date} ${formData.time}\n\näºˆç´„IDã¯å¿…ãšãƒ¡ãƒ¢ã—ã¦ãã ã•ã„ã€‚`);
            
            // Reset form
            document.getElementById('bookingForm').reset();
            showSection('home');
        });

        // Status Check
        document.getElementById('statusForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const query = document.getElementById('searchQuery').value.trim();
            const results = appointments.filter(apt => 
                apt.id === query || apt.phone === query
            );

            const resultsDiv = document.getElementById('searchResults');
            const detailsDiv = document.getElementById('appointmentDetails');

            if (results.length === 0) {
                alert('è©²å½“ã™ã‚‹äºˆç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                resultsDiv.classList.add('hidden');
                return;
            }

            currentAppointment = results[0];
            
            const statusText = {
                'pending': 'æ‰¿èªå¾…ã¡',
                'waiting': 'å—ä»˜æ¸ˆã¿ãƒ»å¾…æ©Ÿä¸­',
                'completed': 'è¨ºç™‚å®Œäº†',
                'cancelled': 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿'
            };

            const statusColor = {
                'pending': 'text-gray-600',
                'waiting': 'text-yellow-600',
                'completed': 'text-green-600',
                'cancelled': 'text-red-600'
            };

            detailsDiv.innerHTML = `
                <div class="grid md:grid-cols-2 gap-4">
                    <div><strong>äºˆç´„ID:</strong> ${currentAppointment.id}</div>
                    <div><strong>æ‚£è€…å:</strong> ${currentAppointment.name}</div>
                    <div><strong>æ—¥æ™‚:</strong> ${currentAppointment.date} ${currentAppointment.time}</div>
                    <div><strong>é›»è©±ç•ªå·:</strong> ${currentAppointment.phone}</div>
                    <div><strong>åŒºåˆ†:</strong> ${currentAppointment.visitType === 'followup' ? 'å†è¨º' : 'åˆè¨º'}</div>
                    <div><strong>çŠ¶æ…‹:</strong> <span class="${statusColor[currentAppointment.status]}">${statusText[currentAppointment.status]}</span></div>
                    <div><strong>ç—‡çŠ¶:</strong> ${currentAppointment.symptoms}</div>
                </div>
            `;

            resultsDiv.classList.remove('hidden');
        });


        // Share Functions
        function shareAppointment() {
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.add('hidden');
        }

        function shareToX() {
            const text = `MediBookã§äºˆç´„ã‚’å–ã‚Šã¾ã—ãŸï¼\n\nğŸ“… äºˆç´„æ—¥æ™‚: ${currentAppointment.date} ${currentAppointment.time}\nğŸ¥ å¾…ã¡æ™‚é–“ã‚‚ç¢ºèªã§ãã¦ä¾¿åˆ©ã§ã™\n\n#ç¶™ç¶šã¯åŠ›ãªã‚Š #åŒ»ç™‚DX #äºˆç´„ã‚·ã‚¹ãƒ†ãƒ `;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank');
            closeShareModal();
        }

        function shareToLine() {
            const text = `MediBookã§äºˆç´„ã‚’å–ã‚Šã¾ã—ãŸï¼\näºˆç´„æ—¥æ™‚: ${currentAppointment.date} ${currentAppointment.time}`;
            const url = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
            closeShareModal();
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
                closeShareModal();
            });
        }

        // QR Code Functions
        function generateQRTicket() {
            const qrData = `MediBookäºˆç´„\näºˆç´„ID: ${currentAppointment.id}\næ‚£è€…å: ${currentAppointment.name}\næ—¥æ™‚: ${currentAppointment.date} ${currentAppointment.time}`;
            
            const qrDiv = document.getElementById('qrCode');
            qrDiv.innerHTML = '';
            
            QRCode.toCanvas(qrDiv, qrData, {
                width: 200,
                height: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function (error) {
                if (error) console.error(error);
            });

            document.getElementById('qrModal').classList.remove('hidden');
        }

        function closeQRModal() {
            document.getElementById('qrModal').classList.add('hidden');
        }

        function modifyAppointment() {
            const newDate = prompt('æ–°ã—ã„æ—¥ä»˜(YYYY-MM-DD)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', currentAppointment.date);
            if (!newDate) return;
            const newTime = prompt('æ–°ã—ã„æ™‚é–“(HH:MM)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', currentAppointment.time);
            if (!newTime) return;
            const conflictExists = appointments.some(apt =>
                apt.date === newDate &&
                apt.time === newTime &&
                apt.status !== 'cancelled' &&
                apt.id !== currentAppointment.id
            );
            if (conflictExists) {
                alert('é¸æŠã•ã‚ŒãŸæ—¥æ™‚ã¯æ—¢ã«äºˆç´„æ¸ˆã¿ã§ã™ã€‚åˆ¥ã®æ™‚é–“ã‚’ãŠé¸ã³ãã ã•ã„ã€‚');
                return;
            }
            currentAppointment.date = newDate;
            currentAppointment.time = newTime;
            currentAppointment.status = 'pending';
            saveData();
            updateStats();
            fetch(FUNCTION_URL, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: currentAppointment.id, date: newDate, time: newTime, status: 'pending' })
            }).then(res => { if (!res.ok) return res.text().then(t => { throw new Error(t); }); })
              .catch(err => console.error(err));
            alert(`äºˆç´„ã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚æ–°ã—ã„æ—¥æ™‚: ${newDate} ${newTime}`);
            document.getElementById('searchResults').classList.add('hidden');
        }

        function cancelAppointment() {
            if (confirm('äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ')) {
                currentAppointment.status = 'cancelled';
                saveData();
                updateStats();
                fetch(FUNCTION_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: currentAppointment.id, status: 'cancelled' })
                }).then(res => { if (!res.ok) return res.text().then(t => { throw new Error(t); }); })
                  .catch(err => console.error(err));
                alert('äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚');
                document.getElementById('searchResults').classList.add('hidden');
            }
        }


        // Navigation Links
        document.querySelectorAll('a[href^="#"]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                
                if (['home', 'booking', 'status'].includes(targetId)) {
                    showSection(targetId);
                } else {
                    const element = document.getElementById(targetId);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth' });
                    }
                }
                
                // Close mobile menu
                document.getElementById('mobileMenu').classList.add('hidden');
            });
        });

        // Service Worker Registration for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript;base64,Ly8gU2VydmljZSBXb3JrZXIgZm9yIE1lZGlCb29rIFBXQQpjb25zdCBDQUNIRV9OQU1FID0gJ21lZGlib29rLXYxJzsKY29uc3QgdXJsc1RvQ2FjaGUgPSBbCiAgJy4vJywKICAnLi9pbmRleC5odG1sJywKXTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignaW5zdGFsbCcsIGV2ZW50ID0+IHsKICBldmVudC53YWl0VW50aWwoCiAgICBjYWNoZXMub3BlbihDQUNIRV9OQU1FKQogICAgICAudGhlbihjYWNoZSA9PiBjYWNoZS5hZGRBbGwodXJsc1RvQ2FjaGUpKQogICk7Cn0pOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHsKICBldmVudC5yZXNwb25kV2l0aCgKICAgIGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KQogICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8IGZldGNoKGV2ZW50LnJlcXVlc3QpOwogICAgICB9KQogICk7Cn0pOw==')
                .then(() => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            const savedSize = parseInt(localStorage.getItem('medibook_fontsize'));
            if (savedSize) {
                setBaseFontSize(savedSize);
            }
            await fetchAppointments();
            updateTime();
            updateStats();
            setInterval(updateTime, 60000); // Update time every minute
            setInterval(async () => { await fetchAppointments(); updateStats(); }, 300000); // every 5 minutes
        });
    </script>
</body>
</html>
